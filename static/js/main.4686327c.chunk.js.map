{"version":3,"sources":["ProfileApp.js","MailApp.js","Home.js","Auth.js","App.js","index.js","assets/anon.png","assets/gray_near_logo.svg","openweb.js","config.js"],"names":["ProfileApp","props","keys","state","reduce","acc","key","chainValues","initialized","console","log","this","setState","Promise","all","map","app","get","values","i","Object","assign","prevProps","init","value","forEach","set","then","className","src","profileUrl","anon","displayName","accountId","htmlFor","placeholder","id","disabled","onChange","e","handleChange","target","bio","onClick","save","React","Component","MailApp","receiverId","subject","content","sending","profileFetchTimeoutId","profileFetchIndex","numLetters","unread","expandedId","inbox","textarea","createRef","profileCache","letter","messageId","undefined","filter","a","push","sort","b","time","read","onNewMail","num","Math","max","modifyLetter","fetchMessages","getFrom","stateChange","profile","profileLoading","fetchProfile","fetchTimeoutId","clearTimeout","pullMessage","message","inner","JSON","parse","type","sender","trunc","newNumLetters","warn","error","setTimeout","sendMessage","stringify","finally","startsWith","Date","toLocaleDateString","join","split","s","current","focus","setSelectionRange","scrollLeft","scrollTop","remove","role","expanded","deleteLetter","replyTo","selectLetter","receiverClass","ref","rows","sendMail","Letter","t","profileName","toLocaleString","d","getDate","hour","getHours","minute","getMinutes","toString","padStart","daytime","timeFormat","Home","requestSignOut","wallet","signOut","signedOutFlow","isSignedIn","window","location","search","includes","replace","origin","pathname","login","apps","logs","loading","signedInFlow","bind","requestSignIn","checkSignIn","initOpenWebApp","nearlib","walletAccount","concat","getAccountId","near","connection","account","code_hash","fetch","data","arrayBuffer","buf","deployContract","Uint8Array","viewMethods","changeMethods","contract","new","masterContract","graph","mail","appId","OpenWebApp","nearConfig","ready","getPublicKey","pk","args","public_key","serialize","SCHEMA","app_id","add_app_key","onKeyAdded","document","title","nearlogo","alt","forceRenderTabPanel","Auth","queryString","pub_key","authorized","new_app_id","new_pub_key","res","App","basename","process","exact","path","component","nearInitPromise","async","getConfig","deps","keyStore","BrowserLocalStorageKeyStore","ReactDOM","render","getElementById","catch","module","exports","config","_config","blocking","resolve","parseEncryptionKey","nacl","Buffer","keyKey","localStorage","getItem","keyPair","fromSecretKey","from","setItem","secretKey","_key","_keyStore","_near","_account","_contract","_networkId","networkId","getKey","_tmpKey","accessKey","fromRandom","Error","setKey","call","msg64","nonce","nonceLength","copy","length","box","decodedBuf","open","str","fullBuf","encrypted","decryptSecretBox","forceReady","wrappedCall","encryptSecretBox","num_messages","pull_message","send_message","receiver_id","env","nodeUrl","contractName","walletUrl","keyPath","HOME","masterAccount","Cookies","require","cookieConfig","getJSON","nearPages"],"mappings":"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","file":"static/js/main.4686327c.chunk.js","sourcesContent":["import React from \"react\";\nimport anon from \"./assets/anon.png\";\n\n\nexport class ProfileApp extends React.Component {\n  constructor(props) {\n    super(props);\n    const keys = [\n      \"displayName\",\n      \"profileUrl\",\n      \"bio\",\n    ];\n    this.state = keys.reduce((acc, key) => {\n      acc[key] = \"\";\n      acc.chainValues[key] = null;\n      return acc;\n    }, {\n      keys,\n      chainValues: {},\n      initialized: false,\n    });\n  }\n\n  async init() {\n    console.log(\"init profile\");\n    this.setState({\n      initialized: true,\n    });\n    const values = await Promise.all(this.state.keys.map((key) => this.props.app.get(key)));\n    console.log(values);\n    const chainValues = this.state.keys.reduce((acc, key, i) => {\n      acc[key] = values[i] || \"\";\n      return acc;\n    }, {});\n    this.setState(Object.assign({chainValues}, chainValues));\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.app && !this.state.initialized) {\n      this.init();\n    }\n  }\n\n  handleChange(key, value) {\n    this.setState({\n      [key]: value,\n    });\n  }\n\n  async save() {\n    console.log(\"Saving\");\n    const chainValues = Object.assign({}, this.state.chainValues);\n    this.state.keys.forEach(key => {\n      if (this.state.chainValues[key] !== this.state[key]) {\n        chainValues[key] = this.state[key];\n        this.props.app.set(key, this.state[key]).then(() => {\n          console.log(\"Updated key `\" + key + \"` to value `\" + this.state[key] + '`');\n        });\n      }\n    });\n    this.setState({\n      chainValues\n    })\n  }\n\n  render() {\n    return (\n      <div>\n        <div>\n          <img className=\"profile-image\" src={this.state.profileUrl || anon}/>\n          <span className=\"letter-expanded-profile\">\n            <span className=\"letter-profile-name\">{this.state.displayName}</span>\n            {this.props.app && <span className=\"letter-account-id\">{\"(@\" + this.props.app.accountId + \")\"}</span>}\n          </span>\n        </div>\n        <hr/>\n        <div>\n          <div className=\"form-group\">\n            <label htmlFor=\"displayName\">Display Name</label>\n            <input placeholder=\"The REAL Satoshi\" id=\"displayName\" className=\"form-control\" disabled={!this.props.app} value={this.state.displayName} onChange={(e) => this.handleChange('displayName', e.target.value)} />\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"profileUrl\">Profile URL</label>\n            <input placeholder={\"https://metanear.com\" + anon} id=\"profileUrl\" className=\"form-control\" disabled={!this.props.app} value={this.state.profileUrl}\n                   onChange={(e) => this.handleChange('profileUrl', e.target.value)}/>\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"bio\">Bio</label>\n            <textarea placeholder=\"I'm working on Bitcoin, so bankers can go home.\" id=\"bio\" className=\"form-control\" disabled={!this.props.app} value={this.state.bio} onChange={(e) => this.handleChange('bio', e.target.value)} />\n          </div>\n          <div className=\"form-group\">\n            <button onClick={() => this.save()}>Save changes</button>\n          </div>\n        </div>\n      </div>\n    )\n  }\n}","import React from \"react\";\nimport anon from \"./assets/anon.png\";\n\nconst RE = \"Re: \";\n\nexport class MailApp extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      initialized: false,\n      receiverId: \"\",\n      subject: \"\",\n      content: \"\",\n      sending: false,\n      profileFetchTimeoutId: null,\n      profileFetchIndex: 0,\n      numLetters: 0,\n      unread: 0,\n      expandedId: -1,\n      inbox: [\n        /*\n        {\n        messageId: -1,\n        sender: \"potato-lord\",\n        subject: \"DOPE\",\n        content: \"HELLO? HELLLOOOOO?\",\n        time: new Date().getTime() - 1000 * 42 * 60,\n      }, {\n        messageId: -2,\n        sender: \"potato-lord\",\n        subject: \"BLABLBALBLABLALBA L BALBLABAL LBLA\",\n        content: \"HELLO? HELLLOOOOO?HELLO? HELLLOOOOO?HELLO? HELLLOOOOO?HELLO? HELLLOOOOO?HELLO? HELLLOOOOO?\",\n        time: new Date().getTime() - 1000 * 23 * 60 * 60,\n      }, {\n        messageId: -4,\n        sender: \"sheeet\",\n        subject: \"Self mailing?\",\n        content: \"Best idea ever!\",\n        time: new Date().getTime() - 2 * 1000 * 24 * 60 * 60,\n      }\n      */\n\n      ],\n    }\n    this.textarea = React.createRef();\n    this.profileCache = {};\n  }\n\n  modifyLetter(letter, messageId) {\n    if (messageId === undefined) {\n      if (!letter) {\n        return;\n      }\n      messageId = letter.messageId;\n    }\n    const inbox = this.state.inbox.filter((a) => a.messageId != messageId);\n    if (letter) {\n      inbox.push(letter);\n    }\n    inbox.sort((a, b) => b.time - a.time);\n    const unread = inbox.reduce((acc, letter) => acc + (letter.read ? 0: 1), 0);\n    this.setState({\n      inbox,\n      unread,\n    });\n    this.props.onNewMail(unread);\n  }\n\n  async init() {\n    console.log(\"init\");\n    this.setState({\n      initialized: true,\n    });\n    this.props.app.get('numLetters').then((num) => {\n      num = num || 0;\n      this.setState({\n        numLetters: num,\n      })\n      for (let i = Math.max(0, num - 10); i < num; ++i) {\n        this.props.app.get('letter_' + i).then((letter) => this.modifyLetter(letter));\n      }\n      this.fetchMessages();\n    });\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.app && !this.state.initialized) {\n      this.init();\n    }\n  }\n\n  async fetchProfile(accountId) {\n    if (accountId in this.profileCache) {\n      return this.profileCache[accountId];\n    } else {\n      console.log(\"Fetching profile for \" + accountId);\n      try {\n        const values = await Promise.all([\n          this.props.app.getFrom(accountId, 'displayName', 'profile'),\n          this.props.app.getFrom(accountId, 'profileUrl', 'profile'),\n        ]);\n        this.profileCache[accountId] = {\n          displayName: values[0] || \"\",\n          profileUrl: values[1],\n        };\n      } catch (e) {\n        this.profileCache[accountId] = false;\n      }\n      return this.profileCache[accountId];\n    }\n  }\n\n  handleChange(key, value) {\n    const stateChange = {\n      [key]: value,\n    };\n    if (key === 'receiverId') {\n      const profileFetchIndex = this.state.profileFetchIndex + 1;\n      stateChange.profileFetchIndex = profileFetchIndex;\n      stateChange.profile = null;\n      if (value) {\n        stateChange.profileLoading = true;\n        this.fetchProfile(value).then((profile) => {\n          if (this.state.profileFetchIndex !== profileFetchIndex) {\n            return;\n          }\n          this.setState({\n            profileLoading: false,\n            profile,\n          });\n        });\n      } else {\n        stateChange.profileLoading = false;\n      }\n    }\n    this.setState(stateChange);\n  }\n\n  fetchMessages() {\n    if (!this.props.app) {\n      return;\n    }\n    if (this.fetchTimeoutId) {\n      clearTimeout(this.fetchTimeoutId);\n      this.fetchTimeoutId = null;\n    }\n    console.log(\"Fetching messages\");\n    this.props.app.pullMessage().then((message) => {\n      if (!message) {\n        this.fetchTimeoutId = setTimeout(() => { this.fetchMessages() }, 60 * 1000);\n        return;\n      }\n      try {\n        console.log(message);\n        const inner = JSON.parse(message.message);\n        if (inner.type === 'mail') {\n          const letter = {\n            messageId: this.state.numLetters,\n            sender: message.sender,\n            subject: inner.subject,\n            content: inner.content,\n            time: Math.trunc(message.time / 1000000),\n          }\n          const newNumLetters = this.state.numLetters + 1;\n          this.setState({\n            numLetters: newNumLetters,\n          });\n\n          this.props.app.set(\"letter_\" + letter.messageId, letter).then(() => {\n            console.log(\"Saved the letter: \", letter);\n          });\n          this.props.app.set(\"numLetters\", newNumLetters).then(() => {\n              console.log(\"Saved the new number of letters: \", newNumLetters);\n          });\n          this.modifyLetter(letter);\n        } else {\n          console.warn(\"Unknown message\", message);\n        }\n      } catch (e) {\n        console.error(e);\n      } finally {\n        this.fetchMessages()\n      }\n    })\n  }\n\n  sendMail() {\n    if (!this.state.profile) {\n      return;\n    }\n    console.log(\"Sending mail\");\n    this.setState({\n      sending: true,\n    });\n    this.props.app.sendMessage(this.state.receiverId, JSON.stringify({\n      type: \"mail\",\n      subject: this.state.subject,\n      content: this.state.content,\n    })).then(() => {\n      this.setState({\n        subject: \"\",\n        content: \"\",\n      })\n    }).finally(() => {\n      this.setState({\n        sending: false,\n      });\n      this.fetchMessages();\n    });\n\n  }\n\n  receiverClass() {\n    if (!this.state.receiverId || this.state.profileLoading) {\n      return \"form-control\";\n    } else if (this.state.profile) {\n      return \"form-control is-valid\";\n    } else {\n      return \"form-control is-invalid\";\n    }\n  }\n\n  replyTo(letter, displayName) {\n    this.handleChange(\"receiverId\", letter.sender);\n    this.setState({\n      subject: (letter.subject.startsWith(RE) ? \"\" : RE) + letter.subject,\n      content: [\n        \"\",\n        \"\",\n        [\"On\", new Date(letter.time).toLocaleDateString(), displayName, \"@\" + letter.sender, \"wrote:\"].join(' '),\n        ...letter.content.split(/\\r?\\n/).map(s => \"| \" + s)\n      ].join(\"\\n\"),\n    }, () => {\n      this.textarea.current.focus();\n      this.textarea.current.setSelectionRange(0, 0);\n      this.textarea.current.scrollLeft = 0;\n      this.textarea.current.scrollTop = 0;\n    });\n  }\n\n  selectLetter(letter) {\n    this.setState({\n      expandedId: (this.state.expandedId === letter.messageId) ? -1 : letter.messageId,\n    });\n    if (!letter.read) {\n      letter = JSON.parse(JSON.stringify(letter));\n      letter.read = true;\n      this.props.app.set(\"letter_\" + letter.messageId, letter).then(() => {\n        console.log(\"Saved the letter: \", letter);\n      });\n      this.modifyLetter(letter);\n    }\n  }\n\n  deleteLetter(letter) {\n    this.props.app.remove(\"letter_\" + letter.messageId).then(() => {\n      console.log(\"Deleted the letter: \", letter);\n    });\n    this.modifyLetter(null, letter.messageId);\n  }\n\n  render() {\n    const profile = this.state.profileLoading ? (\n      <div className=\"col\">\n        <div className=\"spinner-grow\" role=\"status\">\n          <span className=\"sr-only\">Loading...</span>\n        </div>\n      </div>\n    ) : this.state.profile ? (\n      <div className=\"col\">\n        <img className=\"profile-image\" src={this.state.profile.profileUrl || anon}/>\n        <span className=\"profile-name\">{this.state.profile.displayName}</span>\n      </div>\n    ) : null;\n    const inbox = true || this.props.app ?\n      this.state.inbox.map((letter, i) => <Letter\n          key={letter.messageId}\n          fetchProfile={(a) => this.fetchProfile(a)}\n          letter={letter}\n          expanded={letter.messageId == this.state.expandedId}\n          deleteLetter={(letter) => this.deleteLetter(letter)}\n          replyTo={(letter, displayName) => this.replyTo(letter, displayName)}\n          selectLetter={(letter) => this.selectLetter(letter)}/>) :\n      null;\n    return (\n      <div>\n        Inbox <button className=\"btn btn-sm\" onClick={() => this.fetchMessages()}>ðŸ”„</button>\n        <div>\n          {inbox}\n        </div>\n        <h3>Send</h3>\n        <div className=\"form-row\">\n          <div className=\"col\">\n            <div className=\"form-group\">\n              <label className=\"sr-only\" htmlFor=\"toAccountId\">To Account ID</label>\n              <div className=\"input-group\">\n                <div className=\"input-group-prepend\">\n                  <div className=\"input-group-text\">@</div>\n                </div>\n                <input type=\"text\" className={this.receiverClass()} id=\"toAccountId\" placeholder=\"To Account ID\" value={this.state.receiverId} disabled={!this.props.app} onChange={(e) => this.handleChange('receiverId', e.target.value)} />\n              </div>\n            </div>\n          </div>\n          {profile}\n        </div>\n        <div className=\"form-group\">\n          <label className=\"sr-only\" htmlFor=\"subject\">Subject</label>\n          <input type=\"text\" className=\"form-control\" id=\"subject\" placeholder=\"Subject\" disabled={!this.props.app} value={this.state.subject} onChange={(e) => this.handleChange('subject', e.target.value)} />\n        </div>\n        <div className=\"form-group\">\n          <textarea ref={this.textarea} id=\"content\" className=\"form-control\" rows=\"7\" disabled={!this.props.app} value={this.state.content} onChange={(e) => this.handleChange('content', e.target.value)} />\n        </div>\n        <div className=\"form-group\">\n          <button className=\"form-control form-control-lg btn btn-primary\" disabled={!this.state.profile || this.state.sending} onClick={() => this.sendMail()}>Send</button>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport class Letter extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      profile: {\n        profileUrl: null,\n        displayName: '@' + props.letter.sender,\n      },\n    };\n  }\n\n  componentDidMount() {\n    this.props.fetchProfile(this.props.letter.sender).then((profile) => {\n      this.setState({\n        profile,\n      })\n    });\n  }\n\n  onClick() {\n    this.props.selectLetter(this.props.letter);\n  }\n\n  render() {\n    const profileName = (\n      <span className=\"letter-expanded-profile\">\n        <span className=\"letter-profile-name\">{this.state.profile.displayName}</span>\n        <span className=\"letter-account-id\">{\"(@\" + this.props.letter.sender + \")\"}</span>\n      </span>\n    )\n    const profile = (\n      <div className=\"col-sm-6 col-md-4 col-lg-4 letter-profile\">\n        <img className=\"letter-profile-image\" src={this.state.profile.profileUrl || anon}/>\n        {profileName}\n      </div>\n    );\n    const subject = (\n      <div className=\"col-sm-4 col-md\">\n        <div className=\"letter-subject\">{this.props.letter.subject}</div>\n      </div>\n    );\n    const time = this.props.expanded ? (\n      <div className=\"col-sm-2 col-lg-2\">\n        <div className=\"letter-time\">{longTimeFormat(this.props.letter.time)}</div>\n      </div>\n    ) : (\n      <div className=\"col-sm-2 col-lg-1 d-none d-md-block\">\n        <div className=\"letter-time\">{timeFormat(this.props.letter.time)}</div>\n      </div>\n    );\n    if (this.props.expanded) {\n      return (\n        <div className=\"letter letter-expanded\">\n          <div className=\"row letter-expanded-header\" onClick={() => this.onClick()}>\n            {profile}\n            {subject}\n            {time}\n          </div>\n          <div className=\"letter-content-expanded\">\n            <pre>{this.props.letter.content}</pre>\n            <div className=\"row\">\n              <div className=\"col-sm\">\n                <button className=\"btn btn-primary\" onClick={() => this.props.replyTo(this.props.letter, this.state.profile.displayName)}>Reply</button>\n              </div>\n              <div className=\"col-sm\">\n                <button className=\"btn btn-danger float-right\" onClick={() => this.props.deleteLetter(this.props.letter)}>DELETE THIS!</button>\n              </div>\n            </div>\n          </div>\n        </div>\n      );\n    } else {\n      return (\n        <div className={\"row letter letter-small\" + (this.props.letter.read ? \" letter-read\" : \" letter-unread\")} onClick={() => this.onClick()}>\n          {profile}\n          {subject}\n          <div className=\"col-sm d-none d-lg-block\">\n            <div className=\"letter-content\">{this.props.letter.content}</div>\n          </div>\n          {time}\n        </div>\n      );\n    }\n  }\n}\n\nfunction longTimeFormat(t) {\n  return new Date(t).toLocaleString();\n}\n\nfunction timeFormat(t) {\n  const d = new Date(t);\n  const now = new Date();\n  if (now.getDate() === d.getDate()) {\n    const hour = d.getHours() % 12;\n    const minute = d.getMinutes().toString().padStart(2, '0');\n    const daytime = d.getHours() >= 12 ? \"PM\" : \"AM\";\n    return `${hour}:${minute} ${daytime}`;\n  } else {\n    return d.toLocaleDateString();\n  }\n}\n","import React, { Component } from 'react';\nimport nearlogo from './assets/gray_near_logo.svg';\nimport './App.css';\nimport * as nearlib from \"nearlib\";\nimport { OpenWebApp } from './openweb.js';\nimport { ProfileApp } from \"./ProfileApp\";\nimport { MailApp } from \"./MailApp\";\nimport { Tab, Tabs, TabList, TabPanel } from 'react-tabs';\nimport 'react-tabs/style/react-tabs.css';\n\nconst GAS = 2_000_000_000_000_000;\nconst TITLE = \"Open Web Home - NEAR\"\n\nexport class Home extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      login: false,\n      apps: {},\n      logs: [],\n      unread: 0,\n      loading: false,\n    }\n    this.signedInFlow = this.signedInFlow.bind(this);\n    this.requestSignIn = this.requestSignIn.bind(this);\n    this.requestSignOut = this.requestSignOut.bind(this);\n    this.signedOutFlow = this.signedOutFlow.bind(this);\n    this.checkSignIn = this.checkSignIn.bind(this);\n    this.initOpenWebApp = this.initOpenWebApp.bind(this);\n    window.nearlib = nearlib;\n  }\n\n  componentDidMount() {\n    this.checkSignIn();\n  }\n\n  async checkSignIn() {\n    let loggedIn = window.walletAccount.isSignedIn();\n    if (loggedIn) {\n      await this.signedInFlow();\n    } else {\n      this.signedOutFlow();\n    }\n  }\n\n  log(message) {\n    console.log(message);\n    this.setState({\n      logs: this.state.logs.concat([message])\n    })\n  }\n\n  async signedInFlow() {\n    console.log(\"come in sign in flow\")\n    const accountId = await this.props.wallet.getAccountId()\n    this.setState({\n      login: true,\n      loading: true,\n      accountId,\n    })\n    if (window.location.search.includes(\"account_id\")) {\n      window.location.replace(window.location.origin + window.location.pathname)\n    }\n    if (window.location.search.includes(\"all_keys\")) {\n      window.location.replace(window.location.origin + window.location.pathname)\n    }\n    // Initializing our contract APIs by contract name and configuration.\n\n    this.log(\"Connecting to account...\");\n    const account = await new nearlib.Account(window.near.connection, accountId);\n    this.log(\"Querying state...\");\n    let state = await account.state();\n    /*\n    await new Promise((resolve, reject) =>{\n      setTimeout(() => {\n        resolve();\n      }, 5000);\n    })\n     */\n    console.log(state);\n    if (state.code_hash !== '8yr3D9GtRxUgy2ijKo8dcvNQfjHo2JC5ARryVRcFzF6N') {\n      this.log(\"Going to deploy the code\");\n      // no code. Need to deploy.\n      this.log(\"Downloading started...\");\n      let data = await fetch('/open_web.wasm');\n      let buf = await data.arrayBuffer();\n      this.log(\"Downloading done. Deploying contract...\");\n      await account.deployContract(new Uint8Array(buf));\n      if (state.code_hash === '11111111111111111111111111111111') {\n        this.log(\"Deploying done. Initializing contract...\");\n        // Gotta init it.\n        let contract = await new nearlib.Contract(account, accountId, {\n          viewMethods: [],\n          // Change methods can modify the state. But you don't receive the returned value when called.\n          changeMethods: ['new'],\n          // Sender is the account ID to initialize transactions.\n          sender: accountId\n        });\n        console.log(await contract.new());\n      }\n      this.log(\"The contract is deployed\");\n    }\n\n    const masterContract = await new nearlib.Contract(account, accountId, {\n      // View methods are read only. They don't modify the state, but usually return some value.\n      viewMethods: ['apps'],\n      // Change methods can modify the state. But you don't receive the returned value when called.\n      changeMethods: ['add_app_key', 'remove_app_key'],\n      // Sender is the account ID to initialize transactions.\n      sender: accountId\n    });\n\n    this.masterContract = masterContract;\n    window.masterContract = masterContract;\n    this.log(\"Fetching authorized apps...\");\n    console.log(\"Apps:\", await masterContract.apps());\n\n    // this.initOpenWebApp = this.initOpenWebApp.bind(this);\n    \n    this.log(\"Initializing local apps...\");\n    const apps = {\n      profile: await this.initOpenWebApp('profile', accountId),\n      graph: await this.initOpenWebApp('graph', accountId),\n      mail: await this.initOpenWebApp('mail', accountId)\n    };\n    window.apps = apps;\n    this.apps = apps;\n    this.setState({\n      apps,\n      loading: false,\n    })\n    console.log(apps);\n  }\n\n  async initOpenWebApp(appId, accountId) {\n    this.log(\"Initializing app: \" + appId + \" ...\");\n    const app = await new OpenWebApp(appId, accountId, window.nearConfig);\n    await app.init();\n    if (!await app.ready()) {\n      let pk = await app.getPublicKey();\n      this.log(\"Authorizing app for key \" + pk.toString() + \" ...\");\n      const args = {\n        public_key: [...nearlib.utils.serialize.serialize(nearlib.transactions.SCHEMA, pk)],\n        app_id: appId,\n      };\n      await this.masterContract.add_app_key(args, GAS);\n      await app.onKeyAdded();\n    }\n    this.log(\"Done\");\n    return app;\n  }\n\n  async requestSignIn() {\n    const appTitle = 'Open Web Home';\n    await this.props.wallet.requestSignIn(\n      \"\",\n      appTitle\n    )\n  }\n\n  requestSignOut = () => {\n    this.props.wallet.signOut();\n    setTimeout(this.signedOutFlow, 500);\n    console.log(\"after sign out\", this.props.wallet.isSignedIn())\n  }\n\n\n  signedOutFlow = () => {\n    if (window.location.search.includes(\"account_id\")) {\n      window.location.replace(window.location.origin + window.location.pathname)\n    }\n    this.setState({\n      login: false,\n    })\n  }\n\n  render() {\n    document.title = (this.state.unread ? `(${this.state.unread}) ` : \"\") + TITLE;\n    return (\n      <div className=\"App-header\">\n        <div className=\"image-wrapper\">\n          <img className=\"logo\" src={nearlogo} alt=\"NEAR logo\" />\n        </div>\n        <h1>Hello{this.state.login ? \", \" + this.state.accountId : \"?\"}</h1>\n        <div>\n          {this.state.login ? <button onClick={this.requestSignOut}>Log out</button>\n            : <button onClick={this.requestSignIn}>Log in with NEAR</button>}\n        </div>\n        <br/>\n        {this.state.loading && (\n          <div className=\"loading-div\">\n            <div className=\"spinner-grow loading-spinner\" role=\"status\">\n              <span className=\"sr-only\">Loading...</span>\n            </div>\n            <pre className=\"text-left\">\n              {this.state.logs.join(\"\\n\")}\n            </pre>\n          </div>\n        )}\n        {this.state.login && (\n          <div className={\"apps\" + (this.state.loading ? \" d-none\" : \"\")}>\n            <Tabs forceRenderTabPanel={true}>\n              <TabList>\n                <Tab>Profile</Tab>\n                <Tab>Mail {this.state.unread ? `(${this.state.unread})` : \"\"}</Tab>\n              </TabList>\n\n              <TabPanel>\n                <ProfileApp app={this.state.apps.profile}/>\n              </TabPanel>\n              <TabPanel>\n                <MailApp app={this.state.apps.mail} onNewMail={(unread) => this.setState({unread})}/>\n              </TabPanel>\n            </Tabs>\n          </div>\n        )}\n      </div>\n    )\n  }\n\n}\n","import React from \"react\";\nimport queryString from 'query-string';\n\nexport class Auth extends React.Component {\n  constructor(props) {\n    super(props);\n    const values = queryString.parse(this.props.location.search);\n    let {app_id, pub_key} = values;\n    if (app_id && pub_key) {\n      this.state = {\n        authorized:false,\n        new_app_id:app_id,\n        new_pub_key:pub_key\n      };\n    } else {\n      this.state = {\n        authorized:false,\n        new_app_id:\"\",\n        new_pub_key:\"\"\n      }\n    }\n  }\n\n componentDidMount() {\n    if (!this.props.loading && this.state.new_app_id && this.state.new_pub_key) {\n      this.props.initOpenWebApp(this.state.new_app_id, this.state.new_pub_key)\n        .then(res => {\n          this.setState({\n            authorized: true\n          })\n        });\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.app && !this.state.initialized) {\n      // this.init();\n    }\n  }\n  \n  // async fetchProfile(accountId) {\n  //   if (accountId in this.profileCache) {\n  //     return this.profileCache[accountId];\n  //   } else {\n  //     console.log(\"Fetching profile for \" + accountId);\n  //     try {\n  //       const values = await Promise.all([\n  //         this.props.app.getFrom(accountId, 'displayName', 'profile'),\n  //         this.props.app.getFrom(accountId, 'profileUrl', 'profile'),\n  //       ]);\n  //       this.profileCache[accountId] = {\n  //         displayName: values[0] || \"\",\n  //         profileUrl: values[1],\n  //       };\n  //     } catch (e) {\n  //       this.profileCache[accountId] = false;\n  //     }\n  //     return this.profileCache[accountId];\n  //   }\n  // }\n\n  // async registerNewApp(accountId) {\n  //   if (accountId in this.profileCache) {\n  //     return this.profileCache[accountId];\n  //   } else {\n  //     console.log(\"Fetching profile for \" + accountId);\n  //     try {\n  //       const values = await Promise.all([\n  //         this.props.app.getFrom(accountId, 'displayName', 'profile'),\n  //         this.props.app.getFrom(accountId, 'profileUrl', 'profile'),\n  //       ]);\n  //       this.profileCache[accountId] = {\n  //         displayName: values[0] || \"\",\n  //         profileUrl: values[1],\n  //       };\n  //     } catch (e) {\n  //       this.profileCache[accountId] = false;\n  //     }\n  //     return this.profileCache[accountId];\n  //   }\n  // }\n\n  render() {\n    return (\n      <div>\n        {this.state.authorized ? \n        <div>\n          <p>App <strong>{this.state.new_app_id}</strong> was added</p>\n          <p> Using the public key: {this.state.new_pub_key} </p>\n        </div> :\n        \"You need pass a key in order to add an app\"\n        }\n      </div>\n    )\n  }\n}\n","import React, { Component } from 'react';\nimport { BrowserRouter, Route, Switch } from \"react-router-dom\";\nimport { Home } from './Home';\nimport { Auth } from './Auth';\n\nclass App extends Component {\n  render() {\n    return (\n      <BrowserRouter basename={process.env.PUBLIC_URL}>\n        <Switch>\n          <Route exact path=\"/\" component={() => <Home {...this.props}/>} />\n          <Route path=\"/auth\" component={() => <Auth {...this.props}/>} />\n        </Switch>\n      </BrowserRouter>\n    );\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport getConfig from './config.js';\nimport * as nearlib from 'nearlib';\n\n// Initializing contract\nasync function InitContract() {\n    window.nearConfig = getConfig('development')\n    console.log(\"nearConfig\", window.nearConfig);\n\n    // Initializing connection to the NEAR DevNet.\n    window.near = await nearlib.connect(Object.assign({ deps: { keyStore: new nearlib.keyStores.BrowserLocalStorageKeyStore() } }, window.nearConfig));\n    \n    // Needed to access wallet login\n    window.walletAccount = new nearlib.WalletAccount(window.near);\n    \n    // Getting the Account ID. If unauthorized yet, it's just empty string.\n    window.accountId = window.walletAccount.getAccountId();\n\n}\n\nwindow.nearInitPromise = InitContract().then(() => {\n    ReactDOM.render(<App contract={window.contract} wallet={window.walletAccount}/>,\n      document.getElementById('root')\n    );\n  }).catch(console.error)","module.exports = __webpack_public_path__ + \"static/media/anon.5cbbd243.png\";","module.exports = __webpack_public_path__ + \"static/media/gray_near_logo.55517b93.svg\";","import * as nearlib from \"nearlib\";\nimport * as nacl from \"tweetnacl\";\n\nconst GAS = 2_000_000_000_000_000;\n\nexport class OpenWebApp {\n  constructor(appId, accountId, config) {\n    this.appId = appId;\n    this.accountId = accountId;\n    this._config = config;\n    this.blocking = Promise.resolve();\n    this.parseEncryptionKey();\n    window.nacl = nacl;\n    window.Buffer = Buffer;\n  }\n\n  parseEncryptionKey() {\n    const keyKey = \"enc_key:\" + this.appId + \":\";\n    let key = localStorage.getItem(keyKey);\n    if (key) {\n      key = nacl.box.keyPair.fromSecretKey(Buffer.from(key, 'base64'));\n    } else {\n      key = new nacl.box.keyPair();\n      localStorage.setItem(keyKey, Buffer.from(key.secretKey).toString('base64'));\n    }\n    this._key = key;\n  }\n\n  async init() {\n    this._keyStore = new nearlib.keyStores.BrowserLocalStorageKeyStore(\n      localStorage, \"app:\" + this.appId,\n    );\n    this._near = await nearlib.connect(Object.assign({ deps: { keyStore:  this._keyStore } }, this._config));\n    this._account = new nearlib.Account(this._near.connection, this.accountId);\n    this._contract = new nearlib.Contract(this._account, this.accountId, {\n      viewMethods: ['get', 'apps', 'num_messages'],\n      changeMethods: ['set', 'remove', 'pull_message', 'send_message'],\n      sender: this.accountId\n    });\n    this._networkId = this._config.networkId;\n  }\n\n  async ready() {\n    const key = await this._keyStore.getKey(this._networkId, this.accountId);\n    return !!key;\n  }\n\n  async getPublicKey() {\n    const key = await this._keyStore.getKey(this._networkId, this.accountId);\n    if (key) {\n      return key.getPublicKey();\n    }\n    if (this._tmpKey) {\n      return this._tmpKey.getPublicKey();\n    }\n    const accessKey = nearlib.KeyPair.fromRandom('ed25519');\n    this._tmpKey = accessKey;\n    return accessKey.getPublicKey();\n  }\n\n  async onKeyAdded() {\n    if (!this._tmpKey) {\n      throw new Error('The key is not initialized yet');\n    }\n    await this._keyStore.setKey(this._networkId, this.accountId, this._tmpKey);\n    this._tmpKey = null;\n  }\n\n  async forceReady() {\n    if (!await this.ready()) {\n      throw new Error('Not ready yet');\n    }\n  }\n\n  wrappedCall(call) {\n    this.blocking = this.blocking.then(() => call()).catch(() => call());\n    return this.blocking;\n  }\n\n  decryptSecretBox(msg64) {\n    const buf = Buffer.from(msg64, 'base64');\n    const nonce = new Uint8Array(nacl.secretbox.nonceLength);\n    buf.copy(nonce, 0, 0, nonce.length);\n    const box = new Uint8Array(buf.length - nacl.secretbox.nonceLength);\n    buf.copy(box, 0, nonce.length);\n    const decodedBuf = nacl.secretbox.open(box, nonce, this._key.secretKey);\n    return Buffer.from(decodedBuf).toString()\n  }\n\n  encryptSecretBox(str) {\n    const buf = Buffer.from(str);\n    const nonce = nacl.randomBytes(nacl.secretbox.nonceLength);\n    const box = nacl.secretbox(buf, nonce, this._key.secretKey);\n\n    const fullBuf = new Uint8Array(box.length + nacl.secretbox.nonceLength);\n    fullBuf.set(nonce);\n    fullBuf.set(box, nacl.secretbox.nonceLength);\n    return Buffer.from(fullBuf).toString('base64')\n  }\n\n  async get(key, appId, encrypted) {\n    appId = appId || this.appId;\n    let str = await this._contract.get({\n      app_id: appId,\n      key,\n    });\n    if (str) {\n      str = JSON.parse(encrypted ? this.decryptSecretBox(str) : str);\n    }\n    return str;\n  }\n\n  async getFrom(accountId, key, appId, encrypted) {\n    appId = appId || this.appId;\n    const account = new nearlib.Account(this._near.connection, accountId);\n    const contract = new nearlib.Contract(account, accountId, {\n      viewMethods: ['get'],\n      changeMethods: [],\n      sender: this.accountId\n    });\n\n    let str = await contract.get({\n      app_id: appId,\n      key,\n    });\n    if (str) {\n      str = JSON.parse(encrypted ? this.decryptSecretBox(str) : str);\n    }\n    return str;\n  }\n\n  async apps() {\n    return await this._contract.apps();\n  }\n\n  async set(key, value, encrypted) {\n    this.forceReady();\n    await this.wrappedCall(() => this._contract.set({\n      key,\n      value: encrypted ? this.encryptSecretBox(JSON.stringify(value)) : JSON.stringify(value),\n    }, GAS));\n  }\n\n  async remove(key) {\n    this.forceReady();\n    await this.wrappedCall(() => this._contract.remove({\n      key,\n    }, GAS));\n  }\n\n  async pullMessage() {\n    this.forceReady();\n    if (await this._contract.num_messages({app_id: this.appId}) > 0) {\n      return await this.wrappedCall(() => this._contract.pull_message({}, GAS));\n    } else {\n      return null;\n    }\n  }\n\n  async sendMessage(receiverId, message, appId) {\n    this.forceReady();\n    receiverId = receiverId || this.accountId;\n    appId = appId || this.appId;\n    await this.wrappedCall(() => this._contract.send_message({\n      receiver_id: receiverId,\n      app_id: appId,\n      message,\n    }, GAS));\n  }\n}\n\n","(function() {\n    const CONTRACT_NAME = 'react-template'; /* TODO: fill this in!*/\n    const DEFAULT_ENV = 'development'; \n    \n    function getConfig(env) {\n        switch (env) {\n\n        case 'production':\n        case 'development':\n            return {\n                networkId: 'default',\n                nodeUrl: 'https://rpc.nearprotocol.com',\n                contractName: CONTRACT_NAME,\n                walletUrl: 'https://wallet.nearprotocol.com',\n            };\n        case 'staging':\n            return {\n                networkId: 'staging',\n                nodeUrl: 'https://staging-rpc.nearprotocol.com/',\n                contractName: CONTRACT_NAME,\n                walletUrl: 'https://near-wallet-staging.onrender.com',\n            };\n        case 'local':\n            return {\n                networkId: 'local',\n                nodeUrl: 'http://localhost:3030',\n                keyPath: `${process.env.HOME}/.near/validator_key.json`,\n                walletUrl: 'http://localhost:4000/wallet',\n                contractName: CONTRACT_NAME,\n            };\n        case 'test':\n            return {\n                networkId: 'local',\n                nodeUrl: 'http://localhost:3030',\n                contractName: CONTRACT_NAME,\n                masterAccount: 'test.near',\n            };\n        case 'test-remote':\n        case 'ci':\n            return {\n                networkId: 'shared-test',\n                nodeUrl: 'http://shared-test.nearprotocol.com:3030',\n                contractName: CONTRACT_NAME,\n                masterAccount: 'test.near',\n            };\n        case 'ci-staging':\n            return {\n                networkId: 'shared-test-staging',\n                nodeUrl: 'http://staging-shared-test.nearprotocol.com:3030',\n                contractName: CONTRACT_NAME,\n                masterAccount: 'test.near',\n            };\n        default:\n            throw Error(`Unconfigured environment '${env}'. Can be configured in src/config.js.`);\n        }\n    }\n    \n    let Cookies = require('js-cookie');\n    const cookieConfig = typeof Cookies != 'undefined' && Cookies.getJSON('fiddleConfig');\n    if (typeof module !== 'undefined' && module.exports) {\n        console.log(\"module works\")\n        module.exports = getConfig;\n    } else {\n        console.log(\"Cookie works\")\n        window.nearConfig =  cookieConfig && cookieConfig.nearPages ? cookieConfig : getConfig(DEFAULT_ENV);\n    }\n})();\n"],"sourceRoot":""}